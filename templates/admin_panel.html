<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
</head>

<body>
  <h1>Admin Panel</h1>
  <p>Hello {{ session["fname"] }}, this is the admin panel</p>
  <a href="{{ url_for('dashboard') }}">Dashboard</a><br>

  <h2>Users list</h2>
  {% if request.args.get('message') %}
  <p style="color:red">{{ request.args.get('message') }}</p>
  {% endif %}
  <a href=" {{ url_for('new_object') }}"><button>Add new object type</button></a>
  <a href=" {{ url_for('remove_object') }}"><button>Remove object type</button></a>
  <form action="{{ url_for('backup_db') }}" method="POST">
    <button type="submit">Backup Database</button>
  </form>
  <form method="POST" action="{{ url_for('kill_admins') }}"
    onsubmit="return confirm('Are you sure you want to reset the level of users with level >= 20, except yourself?');">
    <button type="submit">Remove admin rights of everyone</button>
  </form>

  <table border="1">
    <tr>
      <th>Username</th>
      <th>Email</th>
      <th>Role</th>
      <th>Is Admin</th>
      <th>Is Verified</th>
      <th>Actions</th>
    </tr>
    {% for user in users %}
    <tr>
      <td>{{ user.username }}</td>
      <td>{{ user.email }}</td>
      <td>{{ user.role }}</td>
      <td>
        {% if user.level >= 20 %}
        Yes
        {% else %}
        No
        {% endif %}
      </td>
      <td>{{ user.is_verified }}</td>
      <td>
        {% if not user.is_verified %}
        <form action="{{ url_for('verify_user', user_id=user.id) }}" method="POST" style="display:inline;">
          <button type="submit">Verify</button>
        </form>
        {% endif %}
        <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST" style="display:inline;">
          <button type="submit" onclick="return confirm('Are you sure you want to delete this profile?');">Delete
            Profile</button>
        </form>
        <a href="{{ url_for('edit_user', user_id=user.id) }}">
          <button>Modify</button>
        </a>
        <a href="{{ url_for('view_login_history', user_id=user.id) }}">
          <button>View Login History</button>
        </a>
      </td>
    </tr>
    {% endfor %}
  </table>

  <h2>Deletion suggestions</h2>
  {% if suggestions %}
  <table border="1">
    <tr>
      <th>Object type</th>
      <th>user</th>
      <th>Action</th>
    </tr>
    {% for suggestion in suggestions %}
    <tr>
      <td>{{ suggestion.table_name }}</td>
      <td>{{ suggestion.username }}</td>
      <td>
        <form action="{{ url_for('delete_table') }}" method="post">
          <input type="hidden" name="table_name" value="{{ suggestion.table_name }}">
          <button type="submit" onclick="return confirm('Delete this table and all objects in it ?');">Delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>No object deletion for now</p>
  {% endif %}
</body>

</html>