<!DOCTYPE html>
<html>
<head>
    <title>Maison Connect√©e</title>
</head>
<body>

    <h1>Gestion des pi√®ces</h1>

    <!-- Formulaire pour cr√©er une nouvelle pi√®ce -->
    <form method="POST" action="/create_piece">
        <label for="new_room">Cr√©er une nouvelle pi√®ce :</label>
        <input type="text" name="new_room" id="new_room" required>
        <button type="submit">Cr√©er</button>
    </form>

    <hr>

    <!-- Formulaire pour s√©lectionner une pi√®ce existante -->
    <form method="GET" action="/select_piece">
        <label for="room_id">Choisir une pi√®ce :</label>
        <select name="room_id" id="room_id" required>
            {% for room in rooms %}
                <option value="{{ room.id }}">{{ room.name }}</option>
            {% endfor %}
        </select>
        <button type="submit">S√©lectionner</button>
    </form>

    {% if selected_room %}
    <hr>
    <h2>Pi√®ce s√©lectionn√©e : {{ selected_room.name }}</h2>

    <!-- ACTIONS DISPONIBLES -->
    <h3>Actions disponibles :</h3>

    <!-- Ajouter un objet -->
    <details open>
        <summary>‚ûï Ajouter un objet</summary>
        <form method="POST" action="/add_object2">
            <input type="hidden" name="room_id" value="{{ selected_room.id }}">

            <label for="object_name">Nom de l'objet :</label>
            <input type="text" name="object_name" required>

            <label for="object_type">Type :</label>
            <input type="text" name="object_type">

            <label for="object_description">Description :</label>
            <textarea name="object_description"></textarea>

            <button type="submit">Ajouter l'objet</button>
        </form>
    </details>

    <!-- Supprimer un objet -->
    <details>
        <summary>üóëÔ∏è Supprimer un objet</summary>
        {% if selected_room.objects %}
            <form method="POST" action="/delete_object2">
                <input type="hidden" name="room_id" value="{{ selected_room.id }}">
                <label for="object_id">Choisir un objet :</label>
                <select name="object_id" required>
                    {% for obj in selected_room.objects %}
                        <option value="{{ obj.id }}">{{ obj.name }} ({{ obj.type or "type inconnu" }})</option>
                    {% endfor %}
                </select>
                <button type="submit">Supprimer</button>
            </form>
        {% else %}
            <p>Aucun objet √† supprimer.</p>
        {% endif %}
    </details>

    <!-- Supprimer la pi√®ce -->
    <details>
        <summary>‚ùå Supprimer la pi√®ce</summary>
        <form method="POST" action="/delete_room2">
            <input type="hidden" name="room_id" value="{{ selected_room.id }}">
            <p>‚ö†Ô∏è Cette action supprimera aussi tous les objets associ√©s.</p>
            <button type="submit" onclick="return confirm('Supprimer cette pi√®ce et tous ses objets ?')">Supprimer la pi√®ce</button>
        </form>
    </details>
    {% endif %}

    <br>
    <hr>

    <h3>Voici la configuration actuel de la maison :</h3>
    
    <table border="1" cellpadding="5" cellspacing="0">
        <thead>
            <tr>
                <th>Nom de la pi√®ce</th>
                <th>Objets dans la pi√®ce</th>
            </tr>
        </thead>
        <tbody>
            {% for room in rooms %}
                <tr>
                    <td>{{ room.name }}</td>
                    <td>
                        {% if room.objects %}
                            <ul>
                                {% for obj in room.objects %}
                                    <li>
                                        <strong>{{ obj.name }}</strong> 
                                        {% if obj.type %} ({{ obj.type }}) {% endif %}
                                        {% if obj.description %} : {{ obj.description }} {% endif %}
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            Aucun objet dans cette pi√®ce.
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
<br><br>
<a href="{{ url_for('dashboard') }}">back</a>
</body>
</html>
