{% extends "base_layout.html" %}

{% block head %}
{{ super() }}
<meta charset="UTF-8"> {# Already likely in base, but doesn't hurt #}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/admin_panel.css') }}">
{% endblock %}

{% block title %}Admin Panel{% endblock %}

{% block list %}
{# Define Admin Navigation #}
<ul class="custom-ul">
  <li><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
  <li><a href="{{ url_for('admin_panel') }}">Admin Panel</a></li> {# Link to self or main admin page #}
  <li><a href="{{ url_for('profile') }}">Profile</a></li>
  <li>
    <a href="{{url_for('logout')}}"><button class="button-signup custom-button">LogOut</button></a>
  </li>
</ul>
{% endblock %}

{% block content %}
<div class="custom-container admin-container"> {# Added admin-container class #}
  <h1>Admin Panel</h1>
  {# Display Flash Message/Request Arg Message #}
  {% if request.args.get('message') %}
  <p class="flash-message">{{ request.args.get('message') }}</p>
  {% endif %}

  {# --- Admin Actions --- #}
  <div class="admin-actions">
    <form action="{{ url_for('backup_db') }}" method="POST">
      <button type="submit" class="custom-button">Backup Database</button>
    </form>
    <form method="POST" action="{{ url_for('kill_admins') }}"
      onsubmit="return confirm('Are you sure you want to reset the level of users with level >= 20, except yourself?');">
      <button type="submit" class="custom-button">Revoke Admin Rights</button> {# Renamed for clarity #}
    </form>
  </div>

  {# --- Users List --- #}
  <h2>Users List</h2>
  <div class="admin-table-container">
    <table class="admin-table"> {# Added class #}
      <thead>
        <tr>
          <th>Username</th>
          <th>Email</th>
          <th>Role</th>
          <th>Is Admin</th>
          <th>Is Verified</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.role }}</td>
          <td>
            {% if user.level >= 20 %}
            <span style="color: green; font-weight: bold;">Yes</span>
            {% else %}
            <span style="color: grey;">No</span>
            {% endif %}
          </td>
          <td>
            {% if user.is_verified %}
            <span style="color: green;">Yes</span>
            {% else %}
            <span style="color: orange;">No</span>
            {% endif %}
          </td>
          <td>
            {% if not user.is_verified %}
            <form action="{{ url_for('verify_user', user_id=user.id) }}" method="POST">
              <button type="submit" class="custom-button">Verify</button>
            </form>
            {% endif %}
            <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST"
              onsubmit="return confirm('Are you sure you want to delete user \'{{ user.username }}\'?');">
              <button type="submit" class="custom-button">Delete</button>
            </form>
            <a href="{{ url_for('edit_user', user_id=user.id) }}">
              <button class="custom-button">Modify</button>
            </a>
            <a href="{{ url_for('view_login_history', user_id=user.id) }}">
              <button class="custom-button">History</button> {# Shorter label #}
            </a>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="6" style="text-align: center; padding: 20px; color: #777;">No users found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {# --- Deletion Suggestions --- #}
  <h2>Deletion Suggestions</h2>
  {% if suggestions %}
  <div class="admin-table-container">
    <table class="admin-table"> {# Added class #}
      <thead>
        <tr>
          <th>Object Type</th>
          <th>Suggested By</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for suggestion in suggestions %}
        <tr>
          <td>{{ suggestion.table_name }}</td>
          <td>{{ suggestion.username }}</td>
          <td>
            <form action="{{ url_for('delete_table') }}" method="post"
              onsubmit="return confirm('Delete table \'{{ suggestion.table_name }}\' and all objects in it?');">
              <input type="hidden" name="table_name" value="{{ suggestion.table_name }}">
              <button type="submit" class="custom-button">Delete Table</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p class="no-suggestions">No object deletion suggestions at the moment.</p> {# Added class #}
  {% endif %}

  <br>
  {# Link back to dashboard using general link style from base_layout.css #}
  <a href="{{ url_for('dashboard') }}" class="back-link" id="back-to-dashboard">‚Üê Back to Dashboard</a>

</div><!-- End admin-container -->
{% endblock %}

{# Optional: Add specific footer content if needed #}
{# {% block footer_li %} {{ super() }} {% endblock %} #}