{% extends "base_layout.html" %} {# Assuming your base template is base_layout.html #}

{% block head %}
{{ super() }} {# Include head content from base_layout.html (like base_layout.css) #}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/manage_maison.css') }}"> {# Link the
new CSS file #}
{% endblock %}

{% block title %}Configuration Maison{% endblock %}

{% block list %}
{# Optional: Define specific navigation for this page or inherit from base #}
{# Example: Keeping it simple like the profile page #}
<ul class="custom-ul">
    <li><a href="{{ url_for('dashboard') }}">Tableau de Bord</a></li>
    {# Add other relevant links if needed #}
    <li><a href="{{ url_for('profile') }}">Profil</a></li>
    <li>
        <a href="{{url_for('logout')}}"><button class="button-signup custom-button">D√©connexion</button></a>
    </li>
</ul>
{% endblock %}


{% block content %}
{# The main content from the previous version goes here, wrapped in the container #}
<div class="custom-container">

    <!-- Section: Gestion Globale -->
    <section class="config-section">
        <h1>Gestion de la Maison</h1>

        <!-- Formulaire pour cr√©er une nouvelle pi√®ce -->
        <form method="POST" action="/create_piece">
            <label for="new_room">Cr√©er une nouvelle pi√®ce :</label>
            <input type="text" name="new_room" id="new_room" required placeholder="Ex: Salon, Cuisine...">
            <button type="submit" class="custom-button">Cr√©er Pi√®ce</button>
        </form>

        <hr style="margin: 25px 0; border-top: 1px solid #eee;">

        <!-- Formulaire pour s√©lectionner une pi√®ce existante -->
        <form method="GET" action="/select_piece">
            <label for="room_id">Choisir une pi√®ce existante :</label>
            <select name="room_id" id="room_id" required>
                <option value="" disabled {% if not selected_room %}selected{% endif %}>-- S√©lectionnez une pi√®ce --
                </option>
                {% for room in rooms %}
                <option value="{{ room.id }}" {% if selected_room and selected_room.id==room.id %}selected{% endif %}>{{
                    room.name }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="custom-button">G√©rer la Pi√®ce</button>
        </form>
    </section>


    {% if selected_room %}
    <!-- Section: Gestion de la Pi√®ce S√©lectionn√©e -->
    <section class="config-section">
        <h2>Pi√®ce : {{ selected_room.name }}</h2>

        <!-- ACTIONS DISPONIBLES -->
        <h3>Actions sur la pi√®ce</h3>

        <!-- Ajouter un objet -->
        <details> {# Start closed by default maybe? Remove 'open' attribute #}
            <summary>‚ûï Ajouter un objet</summary>
            <form method="POST" action="/add_object2">
                <input type="hidden" name="room_id" value="{{ selected_room.id }}">

                <label for="object_name">Nom de l'objet :</label>
                <input type="text" id="object_name" name="object_name" required
                    placeholder="Ex: Lampe bureau, Thermostat...">

                <label for="object_type">Type :</label>
                <input type="text" id="object_type" name="object_type" placeholder="Ex: Lumi√®re, Chauffage, Capteur...">

                <label for="object_description">Description (optionnel) :</label>
                <textarea id="object_description" name="object_description"
                    placeholder="Plus de d√©tails sur l'objet..."></textarea>

                <button type="submit" class="custom-button">Ajouter l'objet</button>
            </form>
        </details>

        <!-- Supprimer un objet -->
        <details>
            <summary>üóëÔ∏è Supprimer un objet</summary>
            {% if selected_room.objects %}
            <form method="POST" action="/delete_object2">
                <input type="hidden" name="room_id" value="{{ selected_room.id }}">
                <label for="object_id_del">Choisir un objet √† supprimer :</label> {# Changed ID to avoid conflict #}
                <select id="object_id_del" name="object_id" required>
                    <option value="" disabled selected>-- S√©lectionnez un objet --</option>
                    {% for obj in selected_room.objects %}
                    <option value="{{ obj.id }}">{{ obj.name }} ({{ obj.type or "type inconnu" }})</option>
                    {% endfor %}
                </select>
                <button type="submit" class="custom-button">Confirmer Suppression</button>
            </form>
            {% else %}
            <p>Aucun objet √† supprimer dans cette pi√®ce.</p>
            {% endif %}
        </details>

        <!-- Supprimer la pi√®ce -->
        <details>
            <summary>‚ùå Supprimer cette pi√®ce</summary>
            <form method="POST" action="/delete_room2">
                <input type="hidden" name="room_id" value="{{ selected_room.id }}">
                <p>‚ö†Ô∏è **Attention :** Cette action est irr√©versible et supprimera la pi√®ce "{{ selected_room.name }}"
                    ainsi que tous les objets qu'elle contient.</p>
                <button type="submit" class="custom-button" style="background-color: #dc3545; border-color: #dc3545;"
                    onclick="return confirm('√ätes-vous absolument s√ªr de vouloir supprimer la pi√®ce \'{{ selected_room.name }}\' et tous ses objets ?')">Supprimer
                    D√©finitivement</button>
            </form>
        </details>
    </section>
    {% endif %}


    <!-- Section: Configuration Actuelle -->
    <section class="config-section">
        <h3>Configuration Actuelle de la Maison</h3>
        <div class="config-table-container">
            <table class="config-table">
                <thead>
                    <tr>
                        <th>Nom de la pi√®ce</th>
                        <th>Objets dans la pi√®ce</th>
                    </tr>
                </thead>
                <tbody>
                    {% for room in rooms %}
                    <tr>
                        <td><strong>{{ room.name }}</strong></td>
                        <td>
                            {% if room.objects %}
                            <ul>
                                {% for obj in room.objects %}
                                <li>
                                    <strong>{{ obj.name }}</strong>
                                    {% if obj.type %} ({{ obj.type }}) {% endif %}
                                    {% if obj.description %} <br><small style="color: #666;">{{ obj.description
                                        }}</small> {% endif %}
                                </li>
                                {% endfor %}
                            </ul>
                            {% else %}
                            <span style="color: #888;">Aucun objet dans cette pi√®ce.</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="2" style="text-align: center; padding: 20px; color: #777;">Aucune pi√®ce n'a √©t√©
                            cr√©√©e pour le moment. Utilisez le formulaire ci-dessus pour commencer.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>

    <br>
    <!-- Use a class for consistent link styling if desired -->
    <a id="back-to-dashboard" href="{{ url_for('dashboard') }}" class="back-link">‚Üê Retour au Tableau de Bord</a>

</div><!-- End custom-container -->
{% endblock %}

{# No need for footer block unless you want to add specific things #}
{# {% block footer_li %}
{{ super() }}
{% endblock %} #}